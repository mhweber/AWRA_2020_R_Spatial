[
["reading-in-spatial-data.html", "Chapter 2 Reading in Spatial Data 2.1 Reading in vector data", " Chapter 2 Reading in Spatial Data There are several ways we typically get spatial data into R: Load spatial files we have on our machine or from remote source Load spatial data that is part of an R package Grab data using API (often making use of particular R packages) Converting flat files with x,y data to spatial data Geocoding data (we saw example of this at beginning) For reading and writing vector and raster data in R, the three primary packages you’ll use are: sf or rgdal for vector formats such as ESRI Shapefiles, GeoJSON, and GPX - both packages use OGR, which is a library under the GDAL source tree,under the hood raster for raster formats such as GeoTIFF or ESRI or ASCII grid using GDAL under the hood We can quickly discover supported I/O vector formats either via sf or rgdal: library(knitr) library(sf) library(rgdal) print(paste0(&#39;There are &#39;,st_drivers(&quot;vector&quot;) %&gt;% nrow(), &#39; vector drivers available using st_read or read_sf&#39;)) ## [1] &quot;There are 82 vector drivers available using st_read or read_sf&quot; kable(head(ogrDrivers(),n=5)) name long_name write copy isVector AeronavFAA Aeronav FAA FALSE FALSE TRUE AmigoCloud AmigoCloud TRUE FALSE TRUE ARCGEN Arc/Info Generate FALSE FALSE TRUE AVCBin Arc/Info Binary Coverage FALSE FALSE TRUE AVCE00 Arc/Info E00 (ASCII) Coverage FALSE FALSE TRUE kable(head(st_drivers(what=&#39;vector&#39;),n=5)) name long_name write copy is_raster is_vector vsi PCIDSK PCIDSK PCIDSK Database File TRUE FALSE TRUE TRUE TRUE netCDF netCDF Network Common Data Format TRUE TRUE TRUE TRUE FALSE PDS4 PDS4 NASA Planetary Data System 4 TRUE TRUE TRUE TRUE TRUE JP2OpenJPEG JP2OpenJPEG JPEG-2000 driver based on OpenJPEG library FALSE TRUE TRUE TRUE TRUE JPEG2000 JPEG2000 JPEG-2000 part 1 (ISO/IEC 15444-1), based on Jasper library FALSE TRUE TRUE TRUE TRUE As well as I/O raster formats via sf: library(knitr) print(paste0(&#39;There are &#39;,st_drivers(what=&#39;raster&#39;) %&gt;% nrow(), &#39; raster drivers available&#39;)) ## [1] &quot;There are 144 raster drivers available&quot; kable(head(st_drivers(what=&#39;raster&#39;),n=5)) name long_name write copy is_raster is_vector vsi VRT VRT Virtual Raster TRUE TRUE TRUE FALSE TRUE DERIVED DERIVED Derived datasets using VRT pixel functions FALSE FALSE TRUE FALSE FALSE GTiff GTiff GeoTIFF TRUE TRUE TRUE FALSE TRUE NITF NITF National Imagery Transmission Format TRUE TRUE TRUE FALSE TRUE RPFTOC RPFTOC Raster Product Format TOC format FALSE FALSE TRUE FALSE TRUE We can see how many drivers are available to sf through gdal: library(dplyr) ## ## Attaching package: &#39;dplyr&#39; ## The following objects are masked from &#39;package:stats&#39;: ## ## filter, lag ## The following objects are masked from &#39;package:base&#39;: ## ## intersect, setdiff, setequal, union library(sf) print(paste0(&#39;There are &#39;,st_drivers(&quot;vector&quot;) %&gt;% nrow(), &#39; vector drivers available using st_read or read_sf&#39;)) ## [1] &quot;There are 82 vector drivers available using st_read or read_sf&quot; print(&#39;They are the following: &#39;) ## [1] &quot;They are the following: &quot; print(st_drivers(&quot;vector&quot;) %&gt;% dplyr::select(FullName = long_name)) ## FullName ## PCIDSK PCIDSK Database File ## netCDF Network Common Data Format ## PDS4 NASA Planetary Data System 4 ## JP2OpenJPEG JPEG-2000 driver based on OpenJPEG library ## JPEG2000 JPEG-2000 part 1 (ISO/IEC 15444-1), based on Jasper library ## PDF Geospatial PDF ## MBTiles MBTiles ## EEDA Earth Engine Data API ## ESRI Shapefile ESRI Shapefile ## MapInfo File MapInfo File ## UK .NTF UK .NTF ## OGR_SDTS SDTS ## S57 IHO S-57 (ENC) ## DGN Microstation DGN ## OGR_VRT VRT - Virtual Datasource ## REC EPIInfo .REC ## Memory Memory ## BNA Atlas BNA ## CSV Comma Separated Value (.csv) ## GML Geography Markup Language (GML) ## GPX GPX ## KML Keyhole Markup Language (KML) ## GeoJSON GeoJSON ## GeoJSONSeq GeoJSON Sequence ## ESRIJSON ESRIJSON ## TopoJSON TopoJSON ## OGR_GMT GMT ASCII Vectors (.gmt) ## GPKG GeoPackage ## SQLite SQLite / Spatialite ## ODBC ODBC ## WAsP WAsP .map format ## PGeo ESRI Personal GeoDatabase ## MSSQLSpatial Microsoft SQL Server Spatial Database ## PostgreSQL PostgreSQL/PostGIS ## MySQL MySQL ## OpenFileGDB ESRI FileGDB ## XPlane X-Plane/Flightgear aeronautical data ## DXF AutoCAD DXF ## CAD AutoCAD Driver ## Geoconcept Geoconcept ## GeoRSS GeoRSS ## GPSTrackMaker GPSTrackMaker ## VFK Czech Cadastral Exchange Data Format ## PGDUMP PostgreSQL SQL dump ## OSM OpenStreetMap XML and PBF ## GPSBabel GPSBabel ## SUA Tim Newport-Peace&#39;s Special Use Airspace Format ## OpenAir OpenAir ## OGR_PDS Planetary Data Systems TABLE ## WFS OGC WFS (Web Feature Service) ## WFS3 OGC WFS 3 client (Web Feature Service) ## HTF Hydrographic Transfer Vector ## AeronavFAA Aeronav FAA ## Geomedia Geomedia .mdb ## EDIGEO French EDIGEO exchange format ## GFT Google Fusion Tables ## SVG Scalable Vector Graphics ## CouchDB CouchDB / GeoCouch ## Cloudant Cloudant / CouchDB ## Idrisi Idrisi Vector (.vct) ## ARCGEN Arc/Info Generate ## SEGUKOOA SEG-P1 / UKOOA P1/90 ## SEGY SEG-Y ## XLS MS Excel format ## ODS Open Document/ LibreOffice / OpenOffice Spreadsheet ## XLSX MS Office Open XML spreadsheet ## ElasticSearch Elastic Search ## Walk Walk ## Carto Carto ## AmigoCloud AmigoCloud ## SXF Storage and eXchange Format ## Selafin Selafin ## JML OpenJUMP JML ## PLSCENES Planet Labs Scenes API ## CSW OGC CSW (Catalog Service for the Web) ## VDV VDV-451/VDV-452/INTREST Data Format ## MVT Mapbox Vector Tiles ## TIGER U.S. Census TIGER/Line ## AVCBin Arc/Info Binary Coverage ## AVCE00 Arc/Info E00 (ASCII) Coverage ## NGW NextGIS Web ## HTTP HTTP Fetching Wrapper 2.1 Reading in vector data sf can be used to read numerous file types: Shapefiles Geodatabases Geopackages Geojson Spatial database files 2.1.1 Shapefiles Typically working with vector GIS data we work with ESRI shapefiles or geodatabases - here we have an example of how one would read in a shapefile using sf: download.file(&quot;ftp://ftp.gis.oregon.gov/adminbound/citylim_2017.zip&quot;,&quot;citylim_2017.zip&quot;) unzip(&quot;citylim_2017.zip&quot;, exdir = &quot;.&quot;) citylims &lt;- st_read(&quot;citylim_2017.shp&quot;) plot(citylims$geometry, axes=T, main=&#39;Oregon City Limits&#39;) # plot it! # want to get rid of scientific notation in your plot? options(scipen=3) plot(citylims$geometry, axes=T, main=&#39;Oregon City Limits&#39;) 2.1.2 st_read versus read_sf Above, I didn’t pass any parameters to st_read - typically I would pass the parameters quiet=TRUE and stringsAsFactors=FALSE - why would this be a good practice in general? 2.1.3 Answer read_sf is an sf alternative to st_read (see this section 1.2.2). Try reading in citylims data above using read_sf and notice difference, and check out help(read_sf). read_sf and writesf` are simply aliases for st_read and st_write with modified default arguments. Big differences are: stringsAsFactors=FALSE quiet=TRUE as_tibble=TRUE 2.1.4 Geodatabases We use st_read or read_sf similarly for reading in an ESRI file geodatabase feature: # download.file(&quot;ftp://ftp.gis.oregon.gov/adminbound/OregonStateParks_20181010.zip&quot;, &quot;OregonStateParks.zip&quot;) # unzip(&quot;OregonStateParks.zip&quot;, exdir = &quot;.&quot;) library(ggplot2) fgdb = &quot;OregonStateParks_20181010.gdb&quot; # List all feature classes in a file geodatabase st_layers(fgdb) ## Driver: OpenFileGDB ## Available layers: ## layer_name geometry_type features fields ## 1 LO_PARKS Multi Polygon 431 15 # Read the feature class parks &lt;- st_read(dsn=fgdb,layer=&quot;LO_PARKS&quot;) ## Reading layer `LO_PARKS&#39; from data source `C:\\Users\\mweber\\GitProjects\\AWRA_2020_R_Spatial\\OregonStateParks_20181010.gdb&#39; using driver `OpenFileGDB&#39; ## Simple feature collection with 431 features and 15 fields ## geometry type: GEOMETRY ## dimension: XY ## bbox: xmin: 222821.4 ymin: 88699.71 xmax: 2243413 ymax: 1655108 ## projected CRS: NAD83(2011) / Oregon GIC Lambert (ft) ggplot(parks) + geom_sf() 2.1.5 Geopackages Another spatial file format is the geopackage. Let’s try a quick read and write of geopackage data. First we’ll read in a geopackage using data that comes with sf using dplyr syntax just to show something a bit different and use read_sf as an alternative to st_read. You may want to try writing the data back out as a geopackage as well. Quick question: What are a couple advantages of geopackages over shapefiles? library(dplyr) nc &lt;- system.file(&quot;gpkg/nc.gpkg&quot;, package=&quot;sf&quot;) %&gt;% read_sf() # reads in glimpse(nc) ## Rows: 100 ## Columns: 15 ## $ AREA &lt;dbl&gt; 0.114, 0.061, 0.143, 0.070, 0.153, 0.097, 0.062, 0.091, 0... ## $ PERIMETER &lt;dbl&gt; 1.442, 1.231, 1.630, 2.968, 2.206, 1.670, 1.547, 1.284, 1... ## $ CNTY_ &lt;dbl&gt; 1825, 1827, 1828, 1831, 1832, 1833, 1834, 1835, 1836, 183... ## $ CNTY_ID &lt;dbl&gt; 1825, 1827, 1828, 1831, 1832, 1833, 1834, 1835, 1836, 183... ## $ NAME &lt;chr&gt; &quot;Ashe&quot;, &quot;Alleghany&quot;, &quot;Surry&quot;, &quot;Currituck&quot;, &quot;Northampton&quot;,... ## $ FIPS &lt;chr&gt; &quot;37009&quot;, &quot;37005&quot;, &quot;37171&quot;, &quot;37053&quot;, &quot;37131&quot;, &quot;37091&quot;, &quot;37... ## $ FIPSNO &lt;dbl&gt; 37009, 37005, 37171, 37053, 37131, 37091, 37029, 37073, 3... ## $ CRESS_ID &lt;int&gt; 5, 3, 86, 27, 66, 46, 15, 37, 93, 85, 17, 79, 39, 73, 91,... ## $ BIR74 &lt;dbl&gt; 1091, 487, 3188, 508, 1421, 1452, 286, 420, 968, 1612, 10... ## $ SID74 &lt;dbl&gt; 1, 0, 5, 1, 9, 7, 0, 0, 4, 1, 2, 16, 4, 4, 4, 18, 3, 4, 1... ## $ NWBIR74 &lt;dbl&gt; 10, 10, 208, 123, 1066, 954, 115, 254, 748, 160, 550, 124... ## $ BIR79 &lt;dbl&gt; 1364, 542, 3616, 830, 1606, 1838, 350, 594, 1190, 2038, 1... ## $ SID79 &lt;dbl&gt; 0, 3, 6, 2, 3, 5, 2, 2, 2, 5, 2, 5, 4, 4, 6, 17, 4, 7, 1,... ## $ NWBIR79 &lt;dbl&gt; 19, 12, 260, 145, 1197, 1237, 139, 371, 844, 176, 597, 13... ## $ geom &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-81.47276 3..., MULTIPOLYGON... 2.1.6 Open spatial data sources There is a wealth of open spatial data accessible online now via static URLs or APIs - a few examples include Data.gov, NASA SECAC Portal, Natural Earth, UNEP GEOdata, and countless others listed here at Free GIS Data 2.1.7 Spatial data from R packages There are also a number of R packages written specifically to provide access to geospatial data - below are a few and we’ll step through some examples of pulling in data using some of these packages. Table 2.1: Example R packages for spatial data retrieval. Package name Description USABoundaries Provide historic and contemporary boundaries of the US tigris Download and use US Census TIGER/Line Shapefiles in R tidycensus Uses Census American Community API to return tidyverse and optionally sf ready data frames FedData Functions for downloading geospatial data from several federal sources elevatr Access elevation data from various APIs (by Jeff Hollister) getlandsat Provides access to Landsat 8 data. osmdata Download and import of OpenStreetMap data. raster The getData() function downloads and imports administrative country, SRTM/ASTER elevation, WorldClim data. rnaturalearth Functions to download Natural Earth vector and raster data, including world country borders. rnoaa An R interface to National Oceanic and Atmospheric Administration (NOAA) climate data. rWBclimate An access to the World Bank climate data. Below is an example of pulling in US states using the rnaturalearth package - note that the default is to pull in data as sp objects and we coerce to sf. Also take a look at the chained operation using dplyr. Try changing the filter or a parameter in ggplot. library(rnaturalearth) library(dplyr) library(ggplot2) states &lt;- ne_states(country = &#39;United States of America&#39;) states_sf &lt;- st_as_sf(states) states_sf %&gt;% dplyr::filter(!name %in% c(&#39;Hawaii&#39;,&#39;Alaska&#39;) &amp; !is.na(name)) %&gt;% ggplot + geom_sf() 2.1.8 Read in raster data Here we use the getData function in the raster package to download elevation into a RasterLayer and grab administrative boundaries from a database of global administrative boundaries - warning: sometimes getData function has trouble accessing the server and download can be a bit slow. Here we see as well how we can use vector spataio polygon data to crop raster data. library(raster) US &lt;- getData(&quot;GADM&quot;,country=&quot;USA&quot;,level=2) Benton &lt;- US[US$NAME_1==&#39;Oregon&#39; &amp; US$NAME_2==&#39;Benton&#39;,] elev &lt;- getData(&#39;SRTM&#39;, lon=-123, lat=44) elev &lt;- crop(elev, Benton) elev &lt;- mask(elev, Benton) plot(Benton, main=&quot;Elevation (m) in Benton County, Oregon&quot;, axes=T) plot(elev, add=TRUE) plot(Benton, add=TRUE) 2.1.9 Read in OpenStreetMap data The osmdata package is a fantastic resource for leveraging the OpenStreetMap (OSM) database. library(osmdata) library(mapview) footway &lt;- opq(bbox = &quot;corvallis oregon&quot;) %&gt;% add_osm_feature(key = &quot;highway&quot;, value = &quot;footway&quot;) %&gt;% osmdata_sf() footway &lt;- footway$osm_lines mapview(footway$geometry) library(osmdata) library(mapview) rstrnts &lt;- opq(bbox = &quot;corvallis oregon&quot;) %&gt;% add_osm_feature(key = &quot;amenity&quot;, value = &quot;restaurant&quot;) %&gt;% osmdata_sf() rstrnts &lt;- rstrnts$osm_points mapview(rstrnts$geometry) We often have flat files, locally on our machine or accessed elsewhere, that have coordinate information which we would like to make spatial: library(devtools) library(readr) library(ggplot2) # install_github(&quot;mhweber/awra2020spatial&quot;, force=TRUE) library(awra2020spatial) gages = read_csv(system.file(&quot;extdata/Gages_flowdata.csv&quot;, package = &quot;awra2020spatial&quot;)) gages_sf &lt;- gages %&gt;% st_as_sf(coords = c(&quot;LON_SITE&quot;, &quot;LAT_SITE&quot;), crs = 4269, remove = FALSE) %&gt;% dplyr::select(STATION_NM,LON_SITE, LAT_SITE) ggplot() + geom_sf(data=gages_sf) "]
]
