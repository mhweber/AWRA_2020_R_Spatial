<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Fundamentals of Spatial Analysis in R</title>
  <meta name="description" content="This is a draft of material for the Fundamentals of Spatial Analysis in R workshop at the AWRA Spring Conference in Austin in March 2020." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Fundamentals of Spatial Analysis in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a draft of material for the Fundamentals of Spatial Analysis in R workshop at the AWRA Spring Conference in Austin in March 2020." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Fundamentals of Spatial Analysis in R" />
  
  <meta name="twitter:description" content="This is a draft of material for the Fundamentals of Spatial Analysis in R workshop at the AWRA Spring Conference in Austin in March 2020." />
  

<meta name="author" content="Marc Weber" />


<meta name="date" content="2020-08-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  

<link rel="next" href="a-little-about-coordinate-reference-systems.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/PopupTable-0.0.1/popup.css" rel="stylesheet" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css\style.css" type="text/css" />
<link rel="stylesheet" href="css\lesson.css" type="text/css" />
<link rel="stylesheet" href="css\bootstrap.min.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Fundamentals of Spatial Analysis in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#workshop-packages-and-data"><i class="fa fa-check"></i><b>1.1</b> Workshop Packages and Data</a><ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#overview"><i class="fa fa-check"></i><b>1.1.1</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#r-basics-review"><i class="fa fa-check"></i><b>1.2</b> R Basics Review</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#spatial-data-in-r"><i class="fa fa-check"></i><b>1.3</b> Spatial Data in R</a><ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#challenge"><i class="fa fa-check"></i><b>1.3.1</b> Challenge</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#answer"><i class="fa fa-check"></i><b>1.3.2</b> Answer</a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#r-spatial-package-landscape"><i class="fa fa-check"></i><b>1.3.3</b> R Spatial Package Landscape</a></li>
<li class="chapter" data-level="1.3.4" data-path="index.html"><a href="index.html#how-did-we-make-this-figure"><i class="fa fa-check"></i><b>1.3.4</b> How did we make this figure?</a></li>
<li class="chapter" data-level="1.3.5" data-path="index.html"><a href="index.html#answer-1"><i class="fa fa-check"></i><b>1.3.5</b> Answer</a></li>
<li class="chapter" data-level="1.3.6" data-path="index.html"><a href="index.html#primary-r-spatial-packages"><i class="fa fa-check"></i><b>1.3.6</b> Primary R spatial packages</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#quick-examples"><i class="fa fa-check"></i><b>1.4</b> Quick examples</a><ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#geocoding-example-with-tmaptools-using-open-street-map"><i class="fa fa-check"></i><b>1.4.1</b> Geocoding example with tmaptools using open street map</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#run-and-examine-code-chunk-above"><i class="fa fa-check"></i><b>1.4.2</b> Run and examine code chunk above</a></li>
<li class="chapter" data-level="1.4.3" data-path="index.html"><a href="index.html#answer-2"><i class="fa fa-check"></i><b>1.4.3</b> Answer</a></li>
<li class="chapter" data-level="1.4.4" data-path="index.html"><a href="index.html#interactive-mapping"><i class="fa fa-check"></i><b>1.4.4</b> Interactive mapping</a></li>
<li class="chapter" data-level="1.4.5" data-path="index.html"><a href="index.html#choropleth-map"><i class="fa fa-check"></i><b>1.4.5</b> Choropleth map</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="a-little-about-coordinate-reference-systems.html"><a href="a-little-about-coordinate-reference-systems.html"><i class="fa fa-check"></i><b>2</b> A little about coordinate reference systems</a></li>
<li class="chapter" data-level="3" data-path="vector-data-with-sf.html"><a href="vector-data-with-sf.html"><i class="fa fa-check"></i><b>3</b> Vector data with sf</a><ul>
<li class="chapter" data-level="3.0.1" data-path="vector-data-with-sf.html"><a href="vector-data-with-sf.html#challenge-chained-spatial-operation"><i class="fa fa-check"></i><b>3.0.1</b> Challenge: Chained spatial operation</a></li>
<li class="chapter" data-level="3.0.2" data-path="index.html"><a href="index.html#answer"><i class="fa fa-check"></i><b>3.0.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="raster-data.html"><a href="raster-data.html"><i class="fa fa-check"></i><b>4</b> Raster data</a></li>
<li class="chapter" data-level="5" data-path="geoprocessing.html"><a href="geoprocessing.html"><i class="fa fa-check"></i><b>5</b> Geoprocessing</a><ul>
<li class="chapter" data-level="5.1" data-path="geoprocessing.html"><a href="geoprocessing.html#example-one"><i class="fa fa-check"></i><b>5.1</b> Example one</a></li>
<li class="chapter" data-level="5.2" data-path="geoprocessing.html"><a href="geoprocessing.html#example-two"><i class="fa fa-check"></i><b>5.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a><ul>
<li class="chapter" data-level="5.2.1" data-path="references.html"><a href="references.html#r-spatial-resources"><i class="fa fa-check"></i><b>5.2.1</b> R Spatial Resources</a></li>
<li class="chapter" data-level="5.2.2" data-path="references.html"><a href="references.html#r-vector-processing-simple-features-resources"><i class="fa fa-check"></i><b>5.2.2</b> R Vector Processing / Simple Features Resources</a></li>
<li class="chapter" data-level="5.2.3" data-path="references.html"><a href="references.html#r-raster-resources"><i class="fa fa-check"></i><b>5.2.3</b> R Raster Resources</a></li>
<li class="chapter" data-level="5.2.4" data-path="references.html"><a href="references.html#r-mapping-resources"><i class="fa fa-check"></i><b>5.2.4</b> R Mapping Resources</a></li>
<li class="chapter" data-level="5.2.5" data-path="references.html"><a href="references.html#general-r-resources"><i class="fa fa-check"></i><b>5.2.5</b> General R Resources</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/mhweber/AWRA_2020_R_Spatial" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Fundamentals of Spatial Analysis in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">Fundamentals of Spatial Analysis in R</h1>
<p class="author"><em>Marc Weber</em></p>
<p class="date"><em>2020-08-04</em></p>
</div>
<div id="intro" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Introduction</h1>
<div class="figure"><span id="fig:unnamed-chunk-1"></span>
<img src="images/WordCloud.PNG" alt="A bit about me" width="100%" />
<p class="caption">
Figure 1.1: A bit about me
</p>
</div>
<ul>
<li><p>Workshop agenda</p>
<ul>
<li>Intro and quick review of basic R objects and methods</li>
<li>Getting spatial data into R</li>
<li>Learning ways to map and visualize spatial data</li>
<li>Understanding coordinate reference systems (CRS)!</li>
<li>Along the way: overview of select <code>tidyverse</code> packages and syntax
<ul>
<li>i.e. <code>ggplot2</code>, <code>dplyr</code>, <code>readr</code>, <code>tidyr</code>, the pipe operator %&gt;%</li>
</ul></li>
<li>Working with vector and raster data in R</li>
<li>If this is all new, don’t sweat it - google things, we’ll answer questions as we go</li>
</ul></li>
<li><p>This portion of workshop there is no expectation of experience with spatial analysis in R - if you already have some experience, you are sure to pick up new tricks - if you don’t, we’ll cover the basics</p></li>
<li><p>We have a limited time to cover a very broad topic, so I’ll move quickly - ask questions as they come up, but if you get lost on steps we’ll have time for discussion at the end and material will be available to peruse at your own speed later.</p></li>
</ul>
<div id="workshop-packages-and-data" class="section level2">
<h2><span class="header-section-number">1.1</span> Workshop Packages and Data</h2>
<ul>
<li><p>Packages you need installed</p>
<ul>
<li><code>sf</code></li>
<li><code>raster</code></li>
<li><code>stars</code></li>
<li><code>tmap</code></li>
<li><code>tmaptools</code></li>
<li><code>dplyr</code></li>
<li><code>devtools</code></li>
<li><code>palmerpenguins</code></li>
<li><code>tigris</code></li>
<li><code>tibble</code></li>
<li><a href="https://github.com/mhweber/awra2020spatial">awra2020spatial</a> - data for this workshop contained in package</li>
</ul></li>
<li><p>Downloading content via Github</p></li>
<li><p>Using RMarkdown and RStudio</p></li>
</ul>
<div id="overview" class="section level3">
<h3><span class="header-section-number">1.1.1</span> Overview</h3>
<div class="figure"><span id="fig:unnamed-chunk-2"></span>
<img src="images/History%20of%20R.png" alt="History of R" width="150%" />
<p class="caption">
Figure 1.2: History of R
</p>
</div>
<p>What is R and why should we use R for spatial analysis? Let’s break that into two questions - first, what is R and why should we use it?</p>
<ul>
<li>A language and environment for statistical computing and graphics</li>
<li>R is lightweight, free, open-source and cross-platform</li>
<li>Works with contributed packages - currently 15,362 - extensibility</li>
<li>Automation and recording of workflow (reproducibility)</li>
<li>Optimized work flow - data manipulation, analysis and visualization all in one place</li>
<li>R does not alter underlying data - manipulation and visualization in memory</li>
<li>R is great for repetetive graphics</li>
</ul>
<p>Second, why use R for spatial, or GIS, work?</p>
<ul>
<li>Spatial and statistical analysis in one environment</li>
<li>Leverage statistical power of R (i.e. modeling spatial data, data visualization, statistical exploration)</li>
<li>Can handle vector and raster data, as well as work with spatial databases and pretty much any data format spatial data comes in</li>
<li>R’s GIS capabilities growing rapidly right now - new packages added monthly - currently about 200 spatial packages (depending on how you categorize)</li>
</ul>
<p>Some drawbacks to using R for GIS work</p>
<ul>
<li>R not as good for interactive use as desktop GIS applications like ArcGIS or QGIS (i.e. editing features, panning, zooming, and analysis on selected subsets of features)</li>
<li>Explicit coordinate system handling by the user, no on-the-fly projection support</li>
<li>In memory analysis does not scale well with large GIS vector and tabular data</li>
<li>Steep learning curve</li>
<li>Up to you to find packages to do what you need - help not always great</li>
</ul>
</div>
</div>
<div id="r-basics-review" class="section level2">
<h2><span class="header-section-number">1.2</span> R Basics Review</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="index.html#cb1-1"></a><span class="kw">getwd</span>()</span></code></pre></div>
<p>Which should return something like:</p>
<pre><code>[1] &quot;/home/marc/GitProjects/AWRA_GIS_R_Workshop&quot;</code></pre>
<p>To see what is in the directory:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="index.html#cb3-1"></a><span class="kw">dir</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;_after_body.html&quot;          &quot;_book&quot;                    
##  [3] &quot;_bookdown.yml&quot;             &quot;_bookdown_files&quot;          
##  [5] &quot;_output.yml&quot;               &quot;02-crs.Rmd&quot;               
##  [7] &quot;03-vector.Rmd&quot;             &quot;04-raster.Rmd&quot;            
##  [9] &quot;05-geoprocessing.Rmd&quot;      &quot;06-references.Rmd&quot;        
## [11] &quot;AWRA_2020_R_Spatial.log&quot;   &quot;AWRA_2020_R_Spatial.pdf&quot;  
## [13] &quot;AWRA_2020_R_Spatial.Rmd&quot;   &quot;AWRA_2020_R_Spatial.Rproj&quot;
## [15] &quot;AWRA_2020_R_Spatial.tex&quot;   &quot;AWRA_2020_R_Spatial_files&quot;
## [17] &quot;book.bib&quot;                  &quot;css&quot;                      
## [19] &quot;docs&quot;                      &quot;images&quot;                   
## [21] &quot;index.Rmd&quot;                 &quot;js&quot;                       
## [23] &quot;packages.bib&quot;              &quot;preamble.tex&quot;             
## [25] &quot;README.md&quot;</code></pre>
<p>To establish a different directory:</p>
<pre><code>setwd(&quot;/home/marc/GitProjects&quot;)</code></pre>
<div id="terminology-data-structures" class="section level4">
<h4><span class="header-section-number">1.2.0.1</span> <strong>Terminology: data structures</strong></h4>
<p>R is an interpreted language (access through a command-line interpreter) with a number of data structures (vectors, matrices, arrays, data frames, lists) and extensible objects (regression models, time-series, geospatial coordinates) and supports procedural programming with functions.</p>
<p>To learn about objects, become friends with the built-in <code>class</code> and <code>str</code> functions. Let’s explore a new dataset - <a href="https://github.com/allisonhorst/palmerpenguins">palmerpenguins</a> - recently developed by Allison Horst as an alternative to the old R standby <code>iris</code> dataset:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="index.html#cb6-1"></a><span class="kw">library</span>(palmerpenguins)</span></code></pre></div>
<pre><code>## Warning: package &#39;palmerpenguins&#39; was built under R version 4.0.2</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="index.html#cb8-1"></a><span class="kw">class</span>(penguins)</span></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="index.html#cb10-1"></a><span class="kw">str</span>(penguins)</span></code></pre></div>
<pre><code>## tibble [344 x 8] (S3: tbl_df/tbl/data.frame)
##  $ species          : Factor w/ 3 levels &quot;Adelie&quot;,&quot;Chinstrap&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ island           : Factor w/ 3 levels &quot;Biscoe&quot;,&quot;Dream&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...
##  $ bill_length_mm   : num [1:344] 39.1 39.5 40.3 NA 36.7 39.3 38.9 39.2 34.1 42 ...
##  $ bill_depth_mm    : num [1:344] 18.7 17.4 18 NA 19.3 20.6 17.8 19.6 18.1 20.2 ...
##  $ flipper_length_mm: int [1:344] 181 186 195 NA 193 190 181 195 193 190 ...
##  $ body_mass_g      : int [1:344] 3750 3800 3250 NA 3450 3650 3625 4675 3475 4250 ...
##  $ sex              : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 2 1 1 NA 1 2 1 2 NA NA ...
##  $ year             : int [1:344] 2007 2007 2007 2007 2007 2007 2007 2007 2007 2007 ...</code></pre>
<p><code>penguins</code> is a tibble and was created as a new alternative to the <code>iris</code> data set that has been used extensively for beginning tutorials on learning R. <code>penguins</code> as you can see is a <a href="https://tibble.tidyverse.org/">tibble</a>, which is a new <code>tidyverse</code> spin on <code>data frames</code>. Data frames consist of rows of observations on columns of values for variables of interest - they are one of the fundamental and most important data structures in R. <code>tibbles</code> make a few improvements / changes to <code>data frames</code> such as:</p>
<ul>
<li>Never converting strings to factors</li>
<li>Never creating row names</li>
<li>Updated print method that only shows first 10 rows, just the columns that fit on the screen, and the type of each column (just as we get using <code>str</code>)</li>
</ul>
<p>We can easily convert objects from <code>tibble</code> to <code>data frame</code> and vice versa:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="index.html#cb12-1"></a><span class="kw">library</span>(tibble)</span>
<span id="cb12-2"><a href="index.html#cb12-2"></a>penguins &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(penguins)</span>
<span id="cb12-3"><a href="index.html#cb12-3"></a>penguins &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(penguins)</span></code></pre></div>
<p>But as we see in the result of <code>str(penguins)</code> above, following the information that <code>penguins</code> is a <code>tibble</code> with 344 observations of 8 variables, we get information on each of the variables, in this case that 2 are numeric, 2 are integers, and 3 are factors - factors encode categorical variables - and <code>str</code> gives us the number of levels in each factor.</p>
<p>First off, R has several main data types:</p>
<ul>
<li>logical</li>
<li>integer</li>
<li>double</li>
<li>complex</li>
<li>character</li>
<li>raw</li>
<li>list</li>
<li>NULL</li>
<li>closure (function)</li>
<li>special</li>
<li>builtin (basic functions and operators)</li>
<li>environment</li>
<li>S4 (some S4 objects)</li>
<li>others you won’t run into at user level</li>
</ul>
<p>We can ask what data type something is using <code>typeof</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="index.html#cb13-1"></a><span class="kw">typeof</span>(penguins)</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<pre><code>[1] &quot;list&quot;</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="index.html#cb16-1"></a><span class="kw">typeof</span>(penguins<span class="op">$</span>bill_length_mm)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<pre><code>[1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="index.html#cb19-1"></a><span class="kw">typeof</span>(penguins<span class="op">$</span>specis)</span></code></pre></div>
<pre><code>## Warning: Unknown or uninitialised column: `specis`.</code></pre>
<pre><code>## [1] &quot;NULL&quot;</code></pre>
<pre><code>[1] &quot;integer&quot;</code></pre>
<p>We see a couple interesting things here - <code>penguins</code>, which we just said is a <code>tibble</code>, is a data type of <code>list</code>. <code>bill_length_mm</code> is data type <code>double</code>, and in <code>str(penguins)</code> we saw it was numeric - that makes sense - but we see that <code>species</code> is data type <code>integer</code>, and in <code>str(penguins)</code> we were told this variable was a factor with three levels. What’s going on here?</p>
<p>First off, <code>class</code> refers to the abstract type of an object in R, whereas <code>typeof</code> or <code>mode</code> refer to how an object is stored in memory. So <code>penguins</code> is an object of class <code>tibble</code>, but it is stored in memory as a list (i.e. each column is an item in a list). Note that this allows tibbles and data frames to have columns of different classes, whereas a matrix needs to be all of the same mode.</p>
<p>For our <code>species</code> column, we see it’s <code>mode</code> is numeric, it’s <code>typeof</code> is <code>integer</code>, and it’s class is <code>factor</code>. Nominal variables in R are treated as a vector of integers 1:k, where k is the number of unique values of that nominal variable and a mapping of the character strings to these integer values.</p>
<p>This allows us to quickly see see all the unique values of a particular nominal variable or quickly re-asign a level of a nominal variable to a new value - remember, everything in R is in memory, so don’t worry about tweaking the data!</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="index.html#cb23-1"></a><span class="kw">levels</span>(penguins<span class="op">$</span>species)</span></code></pre></div>
<pre><code>## [1] &quot;Adelie&quot;    &quot;Chinstrap&quot; &quot;Gentoo&quot;</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="index.html#cb25-1"></a><span class="kw">levels</span>(penguins<span class="op">$</span>species)[<span class="dv">1</span>] &lt;-<span class="st"> &#39;adeliae&#39;</span></span></code></pre></div>
<p>See if you can explain how that re-asignment we just did worked.</p>
<p>To access particular columns in a <code>tibble</code> or <code>data frame</code>, as we saw above, we use the <code>$</code> operatoe. We can see the value of <code>species</code> for each observation in <code>penguins</code> as well as listing of all levels of the variable by running:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="index.html#cb26-1"></a>penguins<span class="op">$</span>species</span></code></pre></div>
<pre><code>##   [1] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##   [8] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [15] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [22] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [29] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [36] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [43] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [50] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [57] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [64] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [71] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [78] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [85] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [92] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
##  [99] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
## [106] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
## [113] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
## [120] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
## [127] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
## [134] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
## [141] adeliae   adeliae   adeliae   adeliae   adeliae   adeliae   adeliae  
## [148] adeliae   adeliae   adeliae   adeliae   adeliae   Gentoo    Gentoo   
## [155] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [162] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [169] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [176] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [183] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [190] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [197] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [204] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [211] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [218] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [225] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [232] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [239] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [246] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [253] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [260] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [267] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   
## [274] Gentoo    Gentoo    Gentoo    Chinstrap Chinstrap Chinstrap Chinstrap
## [281] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [288] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [295] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [302] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [309] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [316] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [323] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [330] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [337] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap
## [344] Chinstrap
## Levels: adeliae Chinstrap Gentoo</code></pre>
<p>To access particular columns or rows of a data frame, we use indexing:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="index.html#cb28-1"></a>penguins[<span class="dv">1</span>,<span class="dv">3</span>] <span class="co"># the 1st row and the 3rd column</span></span></code></pre></div>
<pre><code>## Warning: `...` is not empty.
## 
## We detected these problematic arguments:
## * `needs_dots`
## 
## These dots only exist to allow future extensions and should be empty.
## Did you misspecify an argument?</code></pre>
<pre><code>## # A tibble: 1 x 1
##   bill_length_mm
##            &lt;dbl&gt;
## 1           39.1</code></pre>
<pre><code>[1] 39.1</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="index.html#cb32-1"></a>penguins[<span class="dv">4</span>,<span class="dv">1</span>] <span class="co"># the 4th row and the 1st column</span></span></code></pre></div>
<pre><code>## Warning: `...` is not empty.
## 
## We detected these problematic arguments:
## * `needs_dots`
## 
## These dots only exist to allow future extensions and should be empty.
## Did you misspecify an argument?</code></pre>
<pre><code>## # A tibble: 1 x 1
##   species
##   &lt;fct&gt;  
## 1 adeliae</code></pre>
<pre><code>&lt;fct&gt;  
1 Adelie</code></pre>
<p>A handy function is <code>names</code>, which you can use to get or to set data frame variable names:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="index.html#cb36-1"></a><span class="kw">names</span>(penguins)</span></code></pre></div>
<pre><code>## [1] &quot;species&quot;           &quot;island&quot;            &quot;bill_length_mm&quot;   
## [4] &quot;bill_depth_mm&quot;     &quot;flipper_length_mm&quot; &quot;body_mass_g&quot;      
## [7] &quot;sex&quot;               &quot;year&quot;</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="index.html#cb38-1"></a><span class="kw">names</span>(penguins)[<span class="dv">3</span>] &lt;-<span class="st"> &#39;Bill Length&#39;</span></span></code></pre></div>
<p>Explain what this last line did</p>
<p>A little example of tidy evaluation and piping to do the same thing - we’ll go into more:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="index.html#cb39-1"></a>penguins &lt;-<span class="st"> </span>penguins <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-2"><a href="index.html#cb39-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="st">&#39;Bill_Length&#39;</span>=<span class="st">&#39;Bill Length&#39;</span>)</span>
<span id="cb39-3"><a href="index.html#cb39-3"></a><span class="co"># check it</span></span>
<span id="cb39-4"><a href="index.html#cb39-4"></a><span class="kw">names</span>(penguins)</span></code></pre></div>
<pre><code>## [1] &quot;species&quot;           &quot;island&quot;            &quot;Bill_Length&quot;      
## [4] &quot;bill_depth_mm&quot;     &quot;flipper_length_mm&quot; &quot;body_mass_g&quot;      
## [7] &quot;sex&quot;               &quot;year&quot;</code></pre>
</div>
<div id="review-of-classes-and-methods" class="section level4">
<h4><span class="header-section-number">1.2.0.2</span> <strong>Review of Classes and Methods</strong></h4>
<ul>
<li>Class: object types
<ul>
<li><code>class()</code>: gives the class type</li>
<li><code>typeof()</code>: information on how the object is stored</li>
<li><code>str()</code>: how the object is structured</li>
</ul></li>
<li>Method: generic functions
<ul>
<li><code>print()</code></li>
<li><code>plot()</code></li>
<li><code>summary</code>()</li>
</ul></li>
</ul>
</div>
</div>
<div id="spatial-data-in-r" class="section level2">
<h2><span class="header-section-number">1.3</span> Spatial Data in R</h2>
<p>We can represent spatial data as discrete locations (points, lines or polygons) or as a grid of values rendered on a map as pixels. We typically represent the former type of data (discrete locations) as <em>vector</em> data, with an associated geometry or shape, and some attributes with information about the locations. Examples are:</p>
<ul>
<li>state boundaries with state name and population</li>
<li>rivers with their flow volume and names</li>
<li>polygons of watersheds with their names and associated landscape information</li>
</ul>
<p>We represent the latter type of data (a grid of values as pixels) with <em>rasters</em>. Rasters can be continous (i.e. elevation, precipitation, atmospheric deposition) or they can be categorical (i.e. land use, soil type) - they can also be image based rasters, and they can be single band or multi-band.</p>
<div class="figure"><span id="fig:unnamed-chunk-17"></span>
<img src="images/Rasters4.png" alt="Raster Data" width="100%" />
<p class="caption">
Figure 1.3: Raster Data
</p>
</div>
<p>We will delve into working with each of these types of data in their own sections, but let’s go over how these spatial data types are handled in R briefly.</p>
<p>Basic data structures in R can represent spatial data - all we need is some vectors with location and attribute information - below we generate cites with population, add a polygon, and make a map with a legend - take a minute to run this code in your own R session and make sure you understand what each line is doing.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="index.html#cb41-1"></a>cities &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Ashland&#39;</span>,<span class="st">&#39;Corvallis&#39;</span>,<span class="st">&#39;Bend&#39;</span>,<span class="st">&#39;Portland&#39;</span>,<span class="st">&#39;Newport&#39;</span>)</span>
<span id="cb41-2"><a href="index.html#cb41-2"></a>longitude &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="fl">122.699</span>, <span class="fl">-123.275</span>, <span class="fl">-121.313</span>, <span class="fl">-122.670</span>, <span class="fl">-124.054</span>)</span>
<span id="cb41-3"><a href="index.html#cb41-3"></a>latitude &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">42.189</span>, <span class="fl">44.57</span>, <span class="fl">44.061</span>, <span class="fl">45.523</span>, <span class="fl">44.652</span>)</span>
<span id="cb41-4"><a href="index.html#cb41-4"></a>population &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">20062</span>,<span class="dv">50297</span>,<span class="dv">61362</span>,<span class="dv">537557</span>,<span class="dv">9603</span>)</span>
<span id="cb41-5"><a href="index.html#cb41-5"></a>locs &lt;-<span class="st"> </span><span class="kw">cbind</span>(longitude, latitude) </span>
<span id="cb41-6"><a href="index.html#cb41-6"></a><span class="kw">plot</span>(locs, <span class="dt">cex=</span><span class="kw">sqrt</span>(population<span class="op">*</span>.<span class="dv">0002</span>), <span class="dt">pch=</span><span class="dv">20</span>, <span class="dt">col=</span><span class="st">&#39;red&#39;</span>, </span>
<span id="cb41-7"><a href="index.html#cb41-7"></a>  <span class="dt">main=</span><span class="st">&#39;Population&#39;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">124</span>,<span class="op">-</span><span class="fl">120.5</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">42</span>, <span class="dv">46</span>))</span>
<span id="cb41-8"><a href="index.html#cb41-8"></a><span class="kw">text</span>(locs, cities, <span class="dt">pos=</span><span class="dv">4</span>)</span>
<span id="cb41-9"><a href="index.html#cb41-9"></a></span>
<span id="cb41-10"><a href="index.html#cb41-10"></a><span class="co"># Add a legend</span></span>
<span id="cb41-11"><a href="index.html#cb41-11"></a>breaks &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">20000</span>, <span class="dv">50000</span>, <span class="dv">60000</span>, <span class="dv">100000</span>)</span>
<span id="cb41-12"><a href="index.html#cb41-12"></a><span class="kw">options</span>(<span class="dt">scipen=</span><span class="dv">3</span>)</span>
<span id="cb41-13"><a href="index.html#cb41-13"></a><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="dt">legend=</span>breaks, <span class="dt">pch=</span><span class="dv">20</span>, <span class="dt">pt.cex=</span><span class="dv">1</span><span class="op">+</span>breaks<span class="op">/</span><span class="dv">20000</span>, </span>
<span id="cb41-14"><a href="index.html#cb41-14"></a>  <span class="dt">col=</span><span class="st">&#39;red&#39;</span>, <span class="dt">bg=</span><span class="st">&#39;gray&#39;</span>)</span>
<span id="cb41-15"><a href="index.html#cb41-15"></a></span>
<span id="cb41-16"><a href="index.html#cb41-16"></a><span class="co"># Add polygon</span></span>
<span id="cb41-17"><a href="index.html#cb41-17"></a>lon &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="fl">123.5</span>, <span class="fl">-123.5</span>, <span class="fl">-122.5</span>, <span class="fl">-122.670</span>, <span class="dv">-123</span>)</span>
<span id="cb41-18"><a href="index.html#cb41-18"></a>lat &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">43</span>, <span class="fl">45.5</span>, <span class="dv">44</span>, <span class="dv">43</span>, <span class="dv">43</span>)</span>
<span id="cb41-19"><a href="index.html#cb41-19"></a>x &lt;-<span class="st"> </span><span class="kw">cbind</span>(lon, lat)</span>
<span id="cb41-20"><a href="index.html#cb41-20"></a><span class="kw">polygon</span>(x, <span class="dt">border=</span><span class="st">&#39;blue&#39;</span>)</span>
<span id="cb41-21"><a href="index.html#cb41-21"></a><span class="kw">lines</span>(x, <span class="dt">lwd=</span><span class="dv">3</span>, <span class="dt">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb41-22"><a href="index.html#cb41-22"></a><span class="kw">points</span>(x, <span class="dt">cex=</span><span class="dv">2</span>, <span class="dt">pch=</span><span class="dv">20</span>)</span></code></pre></div>
<p><img src="AWRA_2020_R_Spatial_files/figure-html/basic%20spatial%20data%20structures%20vector-1.png" width="672" /></p>
<p>We can see in this toy example that numeric vectors can represent locations in R for simple mapping. Points just need to be a pair of numbers in cartesian space, and lines and polygons are just a number of these points (note that polygons are closed by having their first point coincide with last point which the polygon function in base R graphics takes care of).</p>
<p>What about raster data? A raster in essence is simply a matrix of values for raster cells</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="index.html#cb42-1"></a><span class="kw">library</span>(<span class="st">&#39;plot.matrix&#39;</span>)</span></code></pre></div>
<pre><code>## Warning: package &#39;plot.matrix&#39; was built under R version 4.0.2</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="index.html#cb44-1"></a><span class="co"># numeric matrix</span></span>
<span id="cb44-2"><a href="index.html#cb44-2"></a>x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="dv">35</span>), <span class="dt">ncol=</span><span class="dv">5</span>) <span class="co"># create a numeric matrix object</span></span>
<span id="cb44-3"><a href="index.html#cb44-3"></a><span class="kw">class</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;matrix&quot; &quot;array&quot;</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="index.html#cb46-1"></a><span class="co">#&gt; [1] &quot;matrix&quot;</span></span>
<span id="cb46-2"><a href="index.html#cb46-2"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="fl">5.1</span>, <span class="fl">4.1</span>, <span class="fl">4.1</span>, <span class="fl">4.1</span>)) <span class="co"># adapt margins</span></span>
<span id="cb46-3"><a href="index.html#cb46-3"></a><span class="kw">plot</span>(x)</span></code></pre></div>
<p><img src="AWRA_2020_R_Spatial_files/figure-html/basic%20spatial%20data%20structures%20raster-1.png" width="672" /></p>
<p>We have a ‘raster’ of cell values in columnns and rows - but what is lacking?</p>
<p>You can do simple things with these spatial representations using basic R structures, but it breaks down quickly if you want to ask any spatial questions - for instance using the first example above, how would we figure out the nearest city to Corvallis? Or imagine the polygon is a county and we wanted to know what cities are within the county? Or how would we superimpose our cities on our raster cells? Or extract the value of a cell at the location of a city?</p>
<div id="challenge" class="section level3 challenge">
<h3><span class="header-section-number">1.3.1</span> Challenge</h3>
<p>What information do we need to properly define spatial vector data and perform spatial operations?</p>
</div>
<div id="answer" class="section level3 solution">
<h3><span class="header-section-number">1.3.2</span> Answer</h3>
<ul>
<li>A coordinate reference system (CRS)</li>
<li>A bounding box or extent</li>
<li>Methods for storing and accessing spatial attributes of data</li>
<li>?</li>
</ul>
</div>
<div id="r-spatial-package-landscape" class="section level3">
<h3><span class="header-section-number">1.3.3</span> R Spatial Package Landscape</h3>
<p><img src="AWRA_2020_R_Spatial_files/figure-html/spatial%20packages-1.png" width="672" /></p>
</div>
<div id="how-did-we-make-this-figure" class="section level3 challenge">
<h3><span class="header-section-number">1.3.4</span> How did we make this figure?</h3>
<p>Look at answer below, run code in your own code editor, see if it makes sense and ask questions</p>
</div>
<div id="answer-1" class="section level3 solution">
<h3><span class="header-section-number">1.3.5</span> Answer</h3>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="index.html#cb47-1"></a><span class="co"># devtools::install_github(&quot;metacran/cranlogs&quot;)</span></span>
<span id="cb47-2"><a href="index.html#cb47-2"></a><span class="kw">library</span>(cranlogs, <span class="dt">quietly =</span> T)</span>
<span id="cb47-3"><a href="index.html#cb47-3"></a><span class="kw">library</span>(ggplot2, <span class="dt">quietly =</span> T)</span>
<span id="cb47-4"><a href="index.html#cb47-4"></a><span class="kw">library</span>(lubridate, <span class="dt">quietly =</span> T)</span>
<span id="cb47-5"><a href="index.html#cb47-5"></a><span class="kw">library</span>(dplyr, <span class="dt">quietly =</span> T)</span>
<span id="cb47-6"><a href="index.html#cb47-6"></a><span class="kw">options</span>(<span class="dt">scipen=</span><span class="dv">3</span>)</span>
<span id="cb47-7"><a href="index.html#cb47-7"></a>stats &lt;-<span class="st"> </span><span class="kw">cran_downloads</span>(<span class="dt">from =</span> <span class="st">&quot;2018-01-01&quot;</span>, <span class="dt">to =</span> <span class="st">&quot;2020-04-01&quot;</span>,<span class="dt">packages =</span> <span class="kw">c</span>(<span class="st">&quot;sp&quot;</span>, <span class="st">&quot;sf&quot;</span>, <span class="st">&quot;raster&quot;</span>, <span class="st">&quot;tmap&quot;</span>, <span class="st">&quot;mapview&quot;</span>, <span class="st">&quot;leaflet&quot;</span>, <span class="st">&quot;ggmap&quot;</span>, <span class="st">&quot;stars&quot;</span>))</span>
<span id="cb47-8"><a href="index.html#cb47-8"></a></span>
<span id="cb47-9"><a href="index.html#cb47-9"></a>monthly_stats &lt;-<span class="st"> </span>stats <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb47-10"><a href="index.html#cb47-10"></a><span class="st">  </span><span class="kw">group_by</span>(<span class="dt">month=</span><span class="kw">floor_date</span>(date, <span class="st">&quot;month&quot;</span>), package) <span class="op">%&gt;%</span></span>
<span id="cb47-11"><a href="index.html#cb47-11"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">amount=</span><span class="kw">sum</span>(count))</span>
<span id="cb47-12"><a href="index.html#cb47-12"></a><span class="kw">ggplot</span>(monthly_stats, <span class="kw">aes</span>(<span class="dt">x=</span>month, <span class="dt">y=</span>amount, <span class="dt">group =</span> package, <span class="dt">colour =</span> package)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="fl">1.5</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_colour_brewer</span>(<span class="dt">palette=</span><span class="st">&quot;Set1&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;R Monthly Spatial Package </span><span class="ch">\n</span><span class="st"> Downloads since 2018&quot;</span>)</span></code></pre></div>
</div>
<div id="primary-r-spatial-packages" class="section level3">
<h3><span class="header-section-number">1.3.6</span> Primary R spatial packages</h3>
<div class="figure"><span id="fig:unnamed-chunk-18"></span>
<img src="images/Prehistoric.jpg" alt="Moving on from `sp`" width="75%" />
<p class="caption">
Figure 1.4: Moving on from <code>sp</code>
</p>
</div>
<p><code>sp</code> was the core vector spatial data package in R for a number of years, and while still used and while many packages still depend on the package, we will make a clean break in this workshop and focus entirely on the new <code>sf</code> package for working with vector data.</p>
<p>This portion of the workshop will focus primarily on the following core packages for working with spatial data in R:
- <code>sf</code> - The core package for working with vector data in R
- <code>raster</code> - Still the primary spatial package for working with raster data in R
- <code>mapview</code> - this is a wrapper package for R <code>leaflet</code> package and I find simpler and more intuitive
- <code>ggolot</code> and <code>tmap</code> - static plotting and thematic maping
- <code>dplyr</code> - Not a spatial package, but <code>sf</code> is “tidy-compliant” and we will follow “tidy” workflows in this portion of the workshop for much or our examples</p>
<p>The <a href="https://cran.r-project.org/web/views/Spatial.html">R Spatial Task View page</a> provides current and comprehensive information on the ecosystem of R packages for working with spatial data - there are hundreds out there for specific tasks - we’ll touch on several others besides core packages above this morning.</p>
</div>
</div>
<div id="quick-examples" class="section level2">
<h2><span class="header-section-number">1.4</span> Quick examples</h2>
<p>Here is just a sampling of few quick spatial tasks.</p>
<div id="geocoding-example-with-tmaptools-using-open-street-map" class="section level3">
<h3><span class="header-section-number">1.4.1</span> Geocoding example with tmaptools using open street map</h3>
<p>Here we’ll use the <code>tmap</code> package and <code>tmaptools</code> to ‘geocode’ a named feature in OpenStreetMap import it into our R session as an <code>sf</code> feature.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="index.html#cb48-1"></a><span class="co"># uses OSM</span></span>
<span id="cb48-2"><a href="index.html#cb48-2"></a><span class="kw">library</span>(tmap)</span></code></pre></div>
<pre><code>## Warning: package &#39;tmap&#39; was built under R version 4.0.2</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="index.html#cb50-1"></a><span class="kw">library</span>(tmaptools)</span></code></pre></div>
<pre><code>## Warning: package &#39;tmaptools&#39; was built under R version 4.0.2</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="index.html#cb52-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb52-2"><a href="index.html#cb52-2"></a>tex_cap &lt;-tmaptools<span class="op">::</span><span class="kw">geocode_OSM</span>(<span class="st">&quot;Texas Capital&quot;</span>, </span>
<span id="cb52-3"><a href="index.html#cb52-3"></a>        <span class="dt">as.sf =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb52-4"><a href="index.html#cb52-4"></a><span class="st">  </span><span class="kw">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1
## Columns: 9
## $ query   &lt;chr&gt; &quot;Texas Capital&quot;
## $ lat     &lt;dbl&gt; -31.46748
## $ lon     &lt;dbl&gt; -64.22844
## $ lat_min &lt;dbl&gt; -31.46748
## $ lat_max &lt;dbl&gt; -31.46748
## $ lon_min &lt;dbl&gt; -64.22995
## $ lon_max &lt;dbl&gt; -64.22723
## $ bbox    &lt;POLYGON [°]&gt; POLYGON ((-64.22995 -31.467...
## $ point   &lt;POINT [°]&gt; POINT (-64.22844 -31.46748)</code></pre>
</div>
<div id="run-and-examine-code-chunk-above" class="section level3 challenge">
<h3><span class="header-section-number">1.4.2</span> Run and examine code chunk above</h3>
<ol style="list-style-type: decimal">
<li>What is the double colon doing?</li>
<li>What is the <code>geocode_OSM</code> function doing?</li>
<li>Explain how the code runs together using the <code>%&gt;%</code> chaining operator</li>
<li>What is <code>glimpse</code>? Is it useful compared to <code>head</code> function?</li>
</ol>
</div>
<div id="answer-2" class="section level3 solution">
<h3><span class="header-section-number">1.4.3</span> Answer</h3>
<ol style="list-style-type: decimal">
<li>It specifies using <code>geocode_OSM</code> from the <code>tmaptools</code> package. R gives namespace preference to packages in order loaded; some packages share function names; so it’s good practice to disambiguate your functions with the double-colon</li>
<li>It is looking up a named feature in OpenStreetMap and returning the coordinates (bonus - we’ll delve into more in next section - what coordinate reference system are coordinates in and how to you find out?)</li>
<li>You would translate code using the <code>&gt;%&gt;</code> operator from:</li>
</ol>
<ul>
<li>do this <code>%&gt;%</code> do that <code>%&gt;%</code> do that</li>
</ul>
<p>To</p>
<ul>
<li>do this <em>then</em> do that <em>then</em> do that</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Technically, it’s a transposed version of <code>print</code> - columns run down page, data across like rows - it additionally gives you the number of observations and variables, and the data type of each column</li>
</ol>
<ul>
<li>bonus: how would you quickly learn more about <code>glimpse</code> from the console?</li>
</ul>
</div>
<div id="interactive-mapping" class="section level3">
<h3><span class="header-section-number">1.4.4</span> Interactive mapping</h3>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="index.html#cb54-1"></a><span class="kw">library</span>(mapview)</span></code></pre></div>
<pre><code>## Warning: package &#39;mapview&#39; was built under R version 4.0.2</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="index.html#cb56-1"></a><span class="kw">mapview</span>(tex_cap)</span></code></pre></div>
<div id="htmlwidget-d6b2fe928a1ae922b04a" style="width:768px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-d6b2fe928a1ae922b04a">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",1,"CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter",2,"CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["OpenStreetMap",3,"OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",4,"Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["OpenTopoMap",5,"OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[-31.4674813,-64.2284407,6,null,"tex_cap",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":2,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0.6},null,null,"<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>1&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>query&emsp;<\/b><\/td><td align='right'>Texas Capital&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>lat&emsp;<\/b><\/td><td align='right'>-31.46748&emsp;<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>lon&emsp;<\/b><\/td><td align='right'>-64.22844&emsp;<\/td><\/tr><tr><td>4<\/td><td><b>lat_min&emsp;<\/b><\/td><td align='right'>-31.46748&emsp;<\/td><\/tr><tr class='alt'><td>5<\/td><td><b>lat_max&emsp;<\/b><\/td><td align='right'>-31.46748&emsp;<\/td><\/tr><tr><td>6<\/td><td><b>lon_min&emsp;<\/b><\/td><td align='right'>-64.22995&emsp;<\/td><\/tr><tr class='alt'><td>7<\/td><td><b>lon_max&emsp;<\/b><\/td><td align='right'>-64.22723&emsp;<\/td><\/tr><tr><td>8<\/td><td><b>bbox&emsp;<\/b><\/td><td align='right'>sfc_POLYGON&emsp;<\/td><\/tr><tr class='alt'><td>9<\/td><td><b>point&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>",{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-64.2284407,-31.4674813,-64.2284407,-31.4674813,"tex_cap","Zoom to tex_cap","<strong> tex_cap <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"tex_cap",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#6666FF"],"labels":["tex_cap"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"tex_cap"}]}],"limits":{"lat":[-31.4674813,-31.4674813],"lng":[-64.2284407,-64.2284407]}},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
<div id="choropleth-map" class="section level3">
<h3><span class="header-section-number">1.4.5</span> Choropleth map</h3>
<p>The excellent <code>tigris</code> package can be used to get census boundaries such as states and counties as vector <code>sf</code> objects in R</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="index.html#cb57-1"></a><span class="kw">library</span>(sf)</span></code></pre></div>
<pre><code>## Linking to GEOS 3.8.0, GDAL 3.0.4, PROJ 6.3.1</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="index.html#cb59-1"></a><span class="kw">library</span>(tigris)</span></code></pre></div>
<pre><code>## Warning: package &#39;tigris&#39; was built under R version 4.0.2</code></pre>
<pre><code>## To enable 
## caching of data, set `options(tigris_use_cache = TRUE)` in your R script or .Rprofile.</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="index.html#cb62-1"></a>counties &lt;-<span class="st"> </span><span class="kw">counties</span>(<span class="st">&quot;Texas&quot;</span>, <span class="dt">cb =</span> <span class="ot">TRUE</span>)</span>
<span id="cb62-2"><a href="index.html#cb62-2"></a>counties<span class="op">$</span>area &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">st_area</span>(counties))</span>
<span id="cb62-3"><a href="index.html#cb62-3"></a><span class="kw">glimpse</span>(counties)</span>
<span id="cb62-4"><a href="index.html#cb62-4"></a></span>
<span id="cb62-5"><a href="index.html#cb62-5"></a><span class="kw">tm_shape</span>(counties) <span class="op">+</span></span>
<span id="cb62-6"><a href="index.html#cb62-6"></a><span class="st">  </span><span class="kw">tm_polygons</span>(<span class="st">&quot;area&quot;</span>, </span>
<span id="cb62-7"><a href="index.html#cb62-7"></a>              <span class="dt">style=</span><span class="st">&quot;quantile&quot;</span>, </span>
<span id="cb62-8"><a href="index.html#cb62-8"></a>              <span class="dt">title=</span><span class="st">&quot;Texas Counties Area&quot;</span>)</span></code></pre></div>
<p><img src="AWRA_2020_R_Spatial_files/figure-html/tmap%20example-1.png" width="768" /></p>

</div>
</div>
</div>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/lesson.js"></script>
            </section>

          </div>
        </div>
      </div>

<a href="a-little-about-coordinate-reference-systems.html" class="navigation navigation-next navigation-unique" aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["AWRA_2020_R_Spatial.pdf", "AWRA_2020_R_Spatial.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
